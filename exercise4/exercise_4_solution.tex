\newcommand{\NUMBER}{4}
\newcommand{\EXERCISES}{3}
% \newcommand{\DEADLINE}{16.11.20}
\newcommand{\COURSE}{Graphical Data}
\newcommand{\STUDENTA}{Philipp von Bachmann, \\Mat.-Nr.: 4116220}
\newcommand{\STUDENTB}{David Ott, \\Mat.-Nr.: 4185646}
\documentclass[a4paper]{scrartcl}
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage{amsmath, enumerate, amssymb, multirow, fancyhdr, color, graphicx, lastpage, listings, tikz, pdflscape, subfigure, float, polynom, hyperref, tabularx, forloop, geometry, listings, fancybox, tikz, forest, tabstackengine, cancel, hyperref}
\input kvmacros
\geometry{a4paper,left=3cm, right=3cm, top=3cm, bottom=3cm}
\pagestyle {fancy}
\fancyhead[C]{\COURSE}
\fancyhead[R]{\today}
\fancyfoot[L]{}
\fancyfoot[C]{}
\fancyfoot[R]{Page \thepage /\pageref*{LastPage}}
\def\header#1#2{
  \begin{center}
    {\Large Assignment #1}\\
    %{(Due by: #2)}
  \end{center}
}

\newcounter{punktelistectr}
\newcounter{punkte}
\newcommand{\punkteliste}[2]{%
  \setcounter{punkte}{#2}%
  \addtocounter{punkte}{-#1}%
  \stepcounter{punkte}%<-- also punkte = m-n+1 = Anzahl Spalten[1]
  \begin{center}%
  \begin{tabularx}{\linewidth}[]{@{}*{\thepunkte}{>{\centering\arraybackslash} X|}@{}>{\centering\arraybackslash}X}
      \forloop{punktelistectr}{#1}{\value{punktelistectr} < #2 } %
      {%
        \thepunktelistectr &
      }
      #2 &  $\Sigma$ \\
      \hline
      \forloop{punktelistectr}{#1}{\value{punktelistectr} < #2 } %
      {%
        &
      } &\\
      \forloop{punktelistectr}{#1}{\value{punktelistectr} < #2 } %
      {%
        &
      } &\\
    \end{tabularx}
  \end{center}
}
\begin{document}

\begin{tabularx}{\linewidth}{m{0.3 \linewidth}X}
  \begin{minipage}{\linewidth}
    \STUDENTA\\
    \STUDENTB
  \end{minipage} & \begin{minipage}{\linewidth}
    \punkteliste{1}{\EXERCISES}
  \end{minipage}\\
\end{tabularx}
\header{Nr. \NUMBER}{\DEADLINE}


\section*{4.1 Radiometry}
  \subsection*{a)}
    As the point light source emits $\Phi_S$ Watts in every direction, its
    radiance is $L_o(d,\omega)=\frac{\Phi_S}{4\pi}$ in every direction. Because it is
    the only light source in the scene which emits light to $x$ from the
    direction $\omega_i$, the integral for the irradiance of x $I_x=\int_\omega
    L(x,w)cos(\theta )d \omega$ collapses to $I_x=L_o(d, \omega_i)cos(\theta )$. This would
    assume however that the light source sits on the unit circle around $x$.
    Therefore, we have to normalize by the distance between $d$ and $x$, resulting in 
    $I_x=\frac{L_o(d, \omega_i)cos(\theta )}{\lvert x-d \rvert}=\frac{L_o(d,
    \omega_i)cos(\theta )}{r^2+d^2}=\frac{\Phi_S cos(\theta )}{4\pi (r^2+d^2)}$\\


Let $w'$ be the direction from x to d
\begin{align*}
  E
  &=\int_\omega L(x,w)cos(\theta )d \omega\\
  &=L(x,w')cos(\theta )\\
  &=\frac{d^2 \Phi cos(\theta )}{dA cos(\theta )d\omega }\\
  \text{as a point is perpendicular to another cos =1}\\
  &=\frac{d^2 \Phi cos(\theta )}{dA 1 d\omega }\\
  \text{Assume $dA =1$, then }dw = 4\pi r^2 \\
  &=\frac{d^2 \Phi cos(\theta )}{4\pi r^2}\\
  \text{The radius is given by }r=\sqrt{r^2+d^2}\\
  &=\frac{d^2 \Phi cos(\theta )}{4\pi r^2+d^2 }\\
\end{align*}

\subsection*{a)}
$\omega = (\theta, \phi)$
\begin{align*}
  E &= \int_{0}^{2\pi} \int_0^{\frac{\pi}{2}} L(x, \omega) \cos \theta \sin \theta d \theta d \phi \\
  &= \int_{0}^{2\pi} \int_0^{\frac{\pi}{2}} \frac{d^2 \Phi}{dA \cos(\theta) d\omega} \cos \theta \sin \theta d \theta d \phi \\
  &= \int_{0}^{2\pi} \int_0^{\frac{\pi}{2}} \frac{d^2 \Phi}{\sin(\theta) d \theta d \phi \cdot r^2 \cos(\theta) d\omega} \cos \theta \sin \theta d \theta d \phi \\
  &= \int_{0}^{2\pi} \int_0^{\frac{\pi}{2}} \frac{d^2 \Phi}{r^2 d \omega} \\
  &= \int_{0}^{2\pi} \int_0^{\frac{\pi}{2}} \frac{d^2 \Phi}{r^2 d \theta d \phi} \\
  &= \\
  &= \frac{\Phi_S \cos(\theta)}{4 \pi(r^2 + d^2)}
\end{align*}

\section*{4.2 Analytical solution of the rendering equation in 2D}
  \subsection*{a)}
    \begin{align*}
      L(x,\omega_o)
      &=L_e(x,\omega_o) + \int_{0}^\pi f_r(\omega, x, \omega_o) L(x,\omega)cos(\phi)d\omega\\
      &=0 + \int_{0}^\pi \frac{1}{2} L(x,\omega)cos(\phi)d\omega\\
      &=\frac{1}{2}\int_{0}^\pi L(x,\omega)cos(\phi)d\omega\\
      &=\frac{1}{2}\int_{0}^\pi L(x,\omega)cos(\phi)d\omega\\
    \end{align*}
    We want to find  the first angle, that hits the area light and the last angle that hits the area light. Trigonometric examination shows that those angles can be calculated with 
    \begin{align*}
      \phi_{lower} = \frac{\pi}{2} - tan^{-1}(p + 1) \\
      \phi_{upper} = \frac{\pi}{2} + tan^{-1}(1-p)
    \end{align*}
    This can be seen when examining that the triangle that is formed from the top left point of the lightsource (-1, 1) with (p, 0) and (-1, 0) has an angle $\alpha'$ at (-1,1) with $\frac{p - (-1)}{1} = tan(\alpha')$. 
    Since a tringle has a total inner angle of $\pi$ and it has a right angle at (-1, 0), the angle $\alpha$ at (p, 0) with $\alpha = \pi - \frac{\pi}{2} - \alpha' = \frac{\pi}{2} - tan^{-1}(p+1)$. This $\alpha$ is the desired angle 
    $\phi_{lower}$. Note that this even holds for $p < -1$. In a similar way $\phi_{upper}$ is found. 
    Examine the triangle ((p,0), (1,0), (1,1)). The angle $\alpha_2'$ at (1,1) has $tan(\alpha_2') = \frac{1-p}{1}$. Therefore the angle $\alpha_2$  at (p, 0) is $\alpha_2 = \pi - \frac{\pi}{2} - tan^{-1}(1-p) = \frac{\pi}{2} - tan^{-1}(1-p)$
    The desired angle $\phi_{upper}$ is the remaining part of the half circle with $\phi_{upper} = \pi - (\frac{\pi}{2} - tan^{-1}(1-p)) = \frac{\pi}{2} + tan^{-1}(1-p)$.

    \begin{align*}
      &=\frac{1}{2}(\int_{0}^{\phi_{lower}} L(x,\omega)cos(\phi)d\omega + \int_{\phi_{lower}}^{\phi_{upper}} L(x,\omega)cos(\phi)d\omega + \int_{\phi_{upper}}^{\pi} L(x,\omega)cos(\phi)d\omega)\\
      &\text{The first and the third integral refer to incident angles that point past the light source, } \\
      &\text{therefore they are 0. The second integral refers to incident angles pointing to the } \\
      &\text{lightsource, where } L(x,\omega) = 1\\
      &=\frac{1}{2} \int_{\phi_{lower}}^{\phi_{upper}} 1\cdot cos(\phi)d\omega\\
      &=\frac{1}{2} \int_{\phi_{lower}}^{\phi_{upper}} cos(\lvert \omega - \frac{\pi}{2} \rvert)d\omega \\
      &=\frac{1}{2} \left( \int_{\frac{\pi}{2} - tan^{-1}(p+1)}^{\frac{\pi}{2}} cos(\frac{\pi}{2} - \omega )d\omega +  \int_{\frac{\pi}{2}}^{\frac{\pi}{2} + tan^{-1}(1-p)}cos(\omega - \frac{\pi}{2} )d\omega\right)\\
      &= \frac{1}{2}\left(\cos \left(\frac{\pi }{2}-\arctan \left(p+1\right)\right)-\cos \left(\arctan \left(-p+1\right)+\frac{\pi }{2}\right)\right) \\
      &= \frac{1}{2}\left( \frac{1-p}{\sqrt{(p-2)p + 2}} + \frac{p+1}{\sqrt{p(p+2) + 2}} \right)
    \end{align*}

    % for authomatic derivation see
    % https://www.symbolab.com/solver/step-by-step/%5Cfrac%7B1%7D%7B2%7D%20%5Cleft(%20%5Cint_%7B%5Cfrac%7B%5Cpi%7D%7B2%7D%20-%20tan%5E%7B-1%7D%5Cleft(p%2B1%5Cright)%7D%5E%7B%5Cfrac%7B%5Cpi%7D%7B2%7D%7D%20cos%5Cleft(%5Cfrac%7B%5Cpi%7D%7B2%7D%20-%20%5Comega%20%5Cright)d%5Comega%20%2B%20%20%5Cint_%7B%5Cfrac%7B%5Cpi%7D%7B2%7D%7D%5E%7B%5Cfrac%7B%5Cpi%7D%7B2%7D%20%2B%20tan%5E%7B-1%7D%5Cleft(1-p%5Cright)%7Dcos%5Cleft(%5Comega%20-%20%5Cfrac%7B%5Cpi%7D%7B2%7D%20%5Cright)d%5Comega%5Cright)
    % and
    % https://www.wolframalpha.com/input/?i=%5Cfrac%7B1%7D%7B2%7D%5Cleft%28%5Ccos+%5Cleft%28%5Cfrac%7B%5Cpi+%7D%7B2%7D-%5Carctan+%5Cleft%28p%2B1%5Cright%29%5Cright%29-%5Ccos+%5Cleft%28%5Carctan+%5Cleft%28-p%2B1%5Cright%29%2B%5Cfrac%7B%5Cpi+%7D%7B2%7D%5Cright%29%5Cright%29

    % The Graph also seems to show a correct distribution of light!
  

\subsection*{b)}

\begin{align*}
  L(x, \omega_o) &= L_e(x, \omega_o) + \int_{y \in S} f_r(\omega_i, x, \omega_o) \cdot L(y, -\omega_i(x,y)) \cdot \frac{\cos \phi_i \cos \phi_y}{\lvert x - y \rvert} \cdot d y_x \\
  &= L_e(x, \omega_o) + \int_{-1}^{1} f_r(\omega_i, x, \omega_o) \cdot L(y, -\omega_i(x,y)) \cdot \frac{\cos \phi_i \cos \phi_y}{\lvert x - y \rvert} \cdot d y_x \\
  & \text{If we are not in a light source this is: } \\
  &= \int_{-1}^{1} f_r(\omega_i, x, \omega_o) \cdot L(y, -\omega_i(x,y)) \cdot \frac{\cos \phi_i \cos \phi_y}{\lvert x - y \rvert} \cdot d y_x \\
  &= \int_{-1}^{1} f_r(\omega_i, x, \omega_o) \cdot L(y, -\omega_i(x,y)) \cdot \frac{\cos \phi_i \cos \phi_y}{\sqrt{(x_x - y_x)^2 + (x_y - y_y)^2}} \cdot d y_x \\
  &= \int_{-1}^{1} f_r(\omega_i, x, \omega_o) \cdot 1 \cdot \frac{\cos \phi_i \cos \phi_y}{\sqrt{(x_x - y_x)^2 + (x_y - y_y)^2}} \cdot d y_x \\
  &= 
\end{align*}


\section*{4.3 Simple Path Tracer}


\end{document}
