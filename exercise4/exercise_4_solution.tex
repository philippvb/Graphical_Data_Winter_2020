\newcommand{\NUMBER}{4}
\newcommand{\EXERCISES}{3}
% \newcommand{\DEADLINE}{16.11.20}
\newcommand{\COURSE}{Graphical Data}
\newcommand{\STUDENTA}{Philipp von Bachmann, \\Mat.-Nr.: 4116220}
\newcommand{\STUDENTB}{David Ott, \\Mat.-Nr.: 4185646}
\documentclass[a4paper]{scrartcl}
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage{amsmath, enumerate, amssymb, multirow, fancyhdr, color, graphicx, lastpage, listings, tikz, pdflscape, subfigure, float, polynom, hyperref, tabularx, forloop, geometry, listings, fancybox, tikz, forest, tabstackengine, cancel, hyperref}
\input kvmacros
\geometry{a4paper,left=3cm, right=3cm, top=3cm, bottom=3cm}
\pagestyle {fancy}
\fancyhead[C]{\COURSE}
\fancyhead[R]{\today}
\fancyfoot[L]{}
\fancyfoot[C]{}
\fancyfoot[R]{Page \thepage /\pageref*{LastPage}}
\def\header#1#2{
  \begin{center}
    {\Large Assignment #1}\\
    %{(Due by: #2)}
  \end{center}
}

\newcounter{punktelistectr}
\newcounter{punkte}
\newcommand{\punkteliste}[2]{%
  \setcounter{punkte}{#2}%
  \addtocounter{punkte}{-#1}%
  \stepcounter{punkte}%<-- also punkte = m-n+1 = Anzahl Spalten[1]
  \begin{center}%
  \begin{tabularx}{\linewidth}[]{@{}*{\thepunkte}{>{\centering\arraybackslash} X|}@{}>{\centering\arraybackslash}X}
      \forloop{punktelistectr}{#1}{\value{punktelistectr} < #2 } %
      {%
        \thepunktelistectr &
      }
      #2 &  $\Sigma$ \\
      \hline
      \forloop{punktelistectr}{#1}{\value{punktelistectr} < #2 } %
      {%
        &
      } &\\
      \forloop{punktelistectr}{#1}{\value{punktelistectr} < #2 } %
      {%
        &
      } &\\
    \end{tabularx}
  \end{center}
}
\begin{document}

\begin{tabularx}{\linewidth}{m{0.3 \linewidth}X}
  \begin{minipage}{\linewidth}
    \STUDENTA\\
    \STUDENTB
  \end{minipage} & \begin{minipage}{\linewidth}
    \punkteliste{1}{\EXERCISES}
  \end{minipage}\\
\end{tabularx}
\header{Nr. \NUMBER}{\DEADLINE}


\section*{4.1 Radiometry}
  \subsection*{a)}
    As the point light source emits $\Phi_S$ Watts in every direction, its
    radiance is $L_o(d,\omega)=\frac{\Phi_S}{4\pi}$ in every direction. Because it is
    the only light source in the scene which emits light to $x$ from the
    direction $\omega_i$, the integral for the irradiance of x $I_x=\int_\omega
    L(x,w)cos(\theta )d \omega$ collapses to $I_x=L_o(d, \omega_i)cos(\theta )$. This would
    assume however that the light source sits on the unit circle around $x$.
    Therefore, we have to normalize by the distance between $d$ and $x$, resulting in 
    $I_x=\frac{L_o(d, \omega_i)cos(\theta )}{\lvert x-d \rvert}=\frac{L_o(d,
    \omega_i)cos(\theta )}{r^2+d^2}=\frac{\Phi_S cos(\theta )}{4\pi (r^2+d^2)}$\\


Let $w'$ be the direction from x to d
\begin{align*}
  E
  &=\int_\omega L(x,w)cos(\theta )d \omega\\
  &=L(x,w')cos(\theta )\\
  &=\frac{d^2 \Phi cos(\theta )}{dA cos(\theta )d\omega }\\
  \text{as a point is perpendicular to another cos =1}\\
  &=\frac{d^2 \Phi cos(\theta )}{dA 1 d\omega }\\
  \text{Assume $dA =1$, then }dw = 4\pi r^2 \\
  &=\frac{d^2 \Phi cos(\theta )}{4\pi r^2}\\
  \text{The radius is given by }r=\sqrt{r^2+d^2}\\
  &=\frac{d^2 \Phi cos(\theta )}{4\pi r^2+d^2 }\\
\end{align*}


\subsection*{a)}
$\omega = (\theta, \phi)$
\begin{align*}
  E &= \int_{0}^{2\pi} \int_0^{\frac{\pi}{2}} L(x, \omega) \cos \theta \sin \theta d \theta d \phi \\
  &= \int_{0}^{2\pi} \int_0^{\frac{\pi}{2}} \frac{d^2 \Phi}{dA \cos(\theta) d\omega} \cos \theta \sin \theta d \theta d \phi \\
  &= \int_{0}^{2\pi} \int_0^{\frac{\pi}{2}} \frac{d^2 \Phi}{\sin(\theta) d \theta d \phi \cdot r^2 \cos(\theta) d\omega} \cos \theta \sin \theta d \theta d \phi \\
  &= \int_{0}^{2\pi} \int_0^{\frac{\pi}{2}} \frac{d^2 \Phi}{r^2 d \omega} \\
  &= \int_{0}^{2\pi} \int_0^{\frac{\pi}{2}} \frac{d^2 \Phi}{r^2 d \theta d \phi} \\
  &= \\
  &= \frac{\Phi_S \cos(\theta)}{4 \pi(r^2 + d^2)}
\end{align*}



\subsection*{b)}
\begin{align*}
  \Phi_E &= \int_{0}^{2\pi} \int_{0}^{\infty} I(r)r\ dr\ d\phi \\
  &= \int_{0}^{2\pi} \int_{0}^{\infty} \frac{\Phi_S \cos(\theta)}{4\pi(r^2 + d^2)} r\ dr\ d\phi \\
  &= \int_{0}^{2\pi} \int_{0}^{\infty} \frac{\Phi_S \frac{d}{\sqrt{d^2 + r^2}}}{4\pi(r^2 + d^2)} r\ dr\ d\phi \\
  &= \Phi_S \int_{0}^{2\pi} \int_{0}^{\infty} \frac{\frac{d}{\sqrt{d^2 + r^2}}}{4\pi(r^2 + d^2)} r\ dr\ d\phi \\
  &= \Phi_S \int_{0}^{2\pi} \int_{0}^{\infty} \frac{d\sqrt{d^2+r^2}}{4\pi \left(r^2+d^2\right)^2} r\ dr\ d\phi \\
  &= \Phi_S \int_{0}^{2\pi} \frac{d}{4\pi \sqrt{d^2}}\ d\phi \\
  &= \Phi_S \int_{0}^{2\pi} \frac{1}{4\pi}\ d\phi \\
  &= \Phi_S \frac{1}{2} \\
  &= \frac{1}{2} \Phi_S \\
  &= 50 W
\end{align*}
% See automatic derivation at 
% https://www.symbolab.com/solver/step-by-step/%5Cint_%7B0%7D%5E%7B%5Cinfty%7D%20%5Cfrac%7Bd%5Csqrt%7Bd%5E%7B2%7D%2Br%5E%7B2%7D%7D%7D%7B4%5Cpi%20%5Cleft(r%5E%7B2%7D%2Bd%5E%7B2%7D%5Cright)%5E%7B2%7D%7D%20r%20dr

So the total radiant power $\Phi_E$ received by $E$ is half of the power of the point light source. Intuitively this could seem much, but it is actually quite reasonable, since exactly half of the light sources 
power is radiated up while the other half is radiated down. For an infinite plane $E$ all of the power that is emitted downwards is received by the plane, which again is half of the light sources radiant power. 


\section*{4.2 Analytical solution of the rendering equation in 2D}
  \subsection*{a)}
    \begin{align*}
      L(x,\omega_o)
      &=L_e(x,\omega_o) + \int_{0}^\pi f_r(\omega, x, \omega_o) L(x,\omega)cos(\phi)d\omega\\
      &=0 + \int_{0}^\pi \frac{1}{2} L(x,\omega)cos(\phi)d\omega\\
      &=\frac{1}{2}\int_{0}^\pi L(x,\omega)cos(\phi)d\omega\\
      &=\frac{1}{2}\int_{0}^\pi L(x,\omega)cos(\phi)d\omega\\
    \end{align*}
    We want to find  the first angle, that hits the area light and the last angle that hits the area light. Trigonometric examination shows that those angles can be calculated with 
    \begin{align*}
      \phi_{lower} = \frac{\pi}{2} - tan^{-1}(p + 1) \\
      \phi_{upper} = \frac{\pi}{2} + tan^{-1}(1-p)
    \end{align*}
    This can be seen when examining that the triangle that is formed from the top left point of the lightsource (-1, 1) with (p, 0) and (-1, 0) has an angle $\alpha'$ at (-1,1) with $\frac{p - (-1)}{1} = tan(\alpha')$. 
    Since a tringle has a total inner angle of $\pi$ and it has a right angle at (-1, 0), the angle $\alpha$ at (p, 0) with $\alpha = \pi - \frac{\pi}{2} - \alpha' = \frac{\pi}{2} - tan^{-1}(p+1)$. This $\alpha$ is the desired angle 
    $\phi_{lower}$. Note that this even holds for $p < -1$. In a similar way $\phi_{upper}$ is found. 
    Examine the triangle ((p,0), (1,0), (1,1)). The angle $\alpha_2'$ at (1,1) has $tan(\alpha_2') = \frac{1-p}{1}$. Therefore the angle $\alpha_2$  at (p, 0) is $\alpha_2 = \pi - \frac{\pi}{2} - tan^{-1}(1-p) = \frac{\pi}{2} - tan^{-1}(1-p)$
    The desired angle $\phi_{upper}$ is the remaining part of the half circle with $\phi_{upper} = \pi - (\frac{\pi}{2} - tan^{-1}(1-p)) = \frac{\pi}{2} + tan^{-1}(1-p)$.

    $ \frac{1}{2}\int_{0}^\pi L(x,\omega)cos(\phi)d\omega$ therefore can be split into 
    \begin{align*}
      &=\frac{1}{2}(\int_{0}^{\phi_{lower}} L(x,\omega)cos(\phi)d\omega + \int_{\phi_{lower}}^{\phi_{upper}} L(x,\omega)cos(\phi)d\omega + \int_{\phi_{upper}}^{\pi} L(x,\omega)cos(\phi)d\omega)\\
      &\text{The first and the third integral refer to incident angles that point past the light source, } \\
      &\text{therefore they are 0. The second integral refers to incident angles pointing to the } \\
      &\text{lightsource, where } L(x,\omega) = 1\\
      &=\frac{1}{2} \int_{\phi_{lower}}^{\phi_{upper}} 1\cdot cos(\phi)d\omega\\
      &=\frac{1}{2} \int_{\phi_{lower}}^{\phi_{upper}} cos(\lvert \omega - \frac{\pi}{2} \rvert)d\omega \\
      &=\frac{1}{2} \left( \int_{\frac{\pi}{2} - tan^{-1}(p+1)}^{\frac{\pi}{2}} cos(\frac{\pi}{2} - \omega )d\omega +  \int_{\frac{\pi}{2}}^{\frac{\pi}{2} + tan^{-1}(1-p)}cos(\omega - \frac{\pi}{2} )d\omega\right)\\
      &= \frac{1}{2}\left(\cos \left(\frac{\pi }{2}-\arctan \left(p+1\right)\right)-\cos \left(\arctan \left(-p+1\right)+\frac{\pi }{2}\right)\right) \\
      &= \frac{1}{2}\left( \frac{1-p}{\sqrt{(p-2)p + 2}} + \frac{p+1}{\sqrt{p(p+2) + 2}} \right) \\
      &= L((p,0), w_o)
    \end{align*}

    % for authomatic derivation see
    % https://www.symbolab.com/solver/step-by-step/%5Cfrac%7B1%7D%7B2%7D%20%5Cleft(%20%5Cint_%7B%5Cfrac%7B%5Cpi%7D%7B2%7D%20-%20tan%5E%7B-1%7D%5Cleft(p%2B1%5Cright)%7D%5E%7B%5Cfrac%7B%5Cpi%7D%7B2%7D%7D%20cos%5Cleft(%5Cfrac%7B%5Cpi%7D%7B2%7D%20-%20%5Comega%20%5Cright)d%5Comega%20%2B%20%20%5Cint_%7B%5Cfrac%7B%5Cpi%7D%7B2%7D%7D%5E%7B%5Cfrac%7B%5Cpi%7D%7B2%7D%20%2B%20tan%5E%7B-1%7D%5Cleft(1-p%5Cright)%7Dcos%5Cleft(%5Comega%20-%20%5Cfrac%7B%5Cpi%7D%7B2%7D%20%5Cright)d%5Comega%5Cright)
    % and
    % https://www.wolframalpha.com/input/?i=%5Cfrac%7B1%7D%7B2%7D%5Cleft%28%5Ccos+%5Cleft%28%5Cfrac%7B%5Cpi+%7D%7B2%7D-%5Carctan+%5Cleft%28p%2B1%5Cright%29%5Cright%29-%5Ccos+%5Cleft%28%5Carctan+%5Cleft%28-p%2B1%5Cright%29%2B%5Cfrac%7B%5Cpi+%7D%7B2%7D%5Cright%29%5Cright%29

    % The Graph also seems to show a correct distribution of light!
  

\subsection*{b)}

\begin{align*}
  L(x, \omega_o) &= L_e(x, \omega_o) + \int_{y \in S} f_r(\omega_i, x, \omega_o) \cdot L(y, -\omega_i(x,y)) \cdot \frac{\cos \phi_i \cos \phi_y}{\lvert x - y \rvert} \cdot d y_x \\
  &= L_e(x, \omega_o) + \int_{-1}^{1} f_r(\omega_i, x, \omega_o) \cdot L(y, -\omega_i(x,y)) \cdot \frac{\cos \phi_i \cos \phi_y}{\lvert x - y \rvert} \cdot d y_x \\
  & \text{If we are not in a light source this is: } \\
  &= \int_{-1}^{1} f_r(\omega_i, x, \omega_o) \cdot L(y, -\omega_i(x,y)) \cdot \frac{\cos \phi_i \cos \phi_y}{\lvert x - y \rvert} \cdot d y_x \\
  &= \int_{-1}^{1} f_r(\omega_i, x, \omega_o) \cdot L(y, -\omega_i(x,y)) \cdot \frac{\cos \phi_i \cos \phi_y}{\sqrt{(x_x - y_x)^2 + (x_y - y_y)^2}} \cdot d y_x \\
\end{align*}

The only material in the scene is the Lambertian meterial at $y=0$ with $f_r(\omega_i, (p,0), w_o) = \frac{1}{2}$. The light source has uniforma radiance of 1 for each point and direction. So:
\begin{align*}
  &= \int_{-1}^{1} \frac{1}{2} \cdot 1 \cdot \frac{\cos \phi_i \cos \phi_y}{\sqrt{(x_x - y_x)^2 + (x_y - y_y)^2}} \cdot d y_x \\
\end{align*}

From inspection, for this specific case for the angles $\phi_i$ and $\phi_y$ it holds $\phi_i = \phi_y$ (Since the area light and the ground line are parallel). 
Furthermore it holds: $tan(\phi_i) = \frac{\lvert y_x - x_x \rvert}{1} = \lvert y_x - x_x \rvert$. Therefore:

\begin{align*}
  &= \frac{1}{2} \int_{-1}^{1} \frac{cos(\tan^{-1}(\lvert y_x - x_x \rvert))^2}{\sqrt{(x_x - y_x)^2 + (x_y - y_y)^2}} d y_x
\end{align*}

With $cos(tan^{-1}(x) = \frac{1}{\sqrt{1 + x^2}})$ we get:

\begin{align*}
  &= \frac{1}{2} \int_{-1}^{1} \frac{\left(\frac{1}{\sqrt{1 + (\lvert y_x - x_x \rvert)^2}}\right)^2}{\sqrt{(x_x - y_x)^2 + (x_y - y_y)^2}} d y_x \\
  &= \frac{1}{2} \int_{-1}^{1} \frac{\left(\frac{1}{\sqrt{1 + ( y_x - x_x )^2}}\right)^2}{\sqrt{(x_x - y_x)^2 + (x_y - y_y)^2}} d y_x \\
  &= \frac{1}{2} \int_{-1}^{1} \frac{\frac{1}{1 + ( y_x - x_x )^2}}{\sqrt{(x_x - y_x)^2 + (x_y - y_y)^2}} d y_x \\
  &= \frac{1}{2} \int_{-1}^{1} \frac{1}{(\sqrt{(x_x - y_x)^2 + (x_y - y_y)^2}) \cdot (1 + ( y_x - x_x )^2)} d y_x \\
\end{align*}
by replacing $x_x := p$, $x_y = 0, y_y=1$ and $y_y:=t$ wet get
\begin{align*}
  &= \frac{1}{2} \int_{-1}^{1} \frac{1}{(\sqrt{(p - y_x)^2 + (0 - 1)^2}) \cdot (1 + ( y_x - p)^2)} d y_x \\
  &= \frac{1}{2} \int_{-1}^{1} \frac{1}{(\sqrt{(p - y_x)^2 + 1}) \cdot (1 + ( y_x - p)^2)} d y_x \\
  &= \frac{1}{2} \int_{-1}^{1} \frac{1}{(\sqrt{(p - t)^2 + 1}) \cdot (1 + ( t- p)^2)} d t \\
\end{align*}


Automatic integration shows that
\begin{align*}
  \int \frac{1}{(\sqrt{(p - t)^2 + 1}) \cdot (1 + ( t- p)^2)} dt = \frac{t-p}{\sqrt{p^2 - pt + t^2 + 1}} + C
\end{align*}
% https://www.wolframalpha.com/input/?i=%5Cfrac%7B1%7D%7B%28%5Csqrt%7B%28p+-+t%29%5E2+%2B+1%7D%29+%5Ccdot+%281+%2B+%28+t-+p%29%5E2%29%7D+d+t

so

\begin{align*}
  \frac{1}{2} \int_{-1}^{1} \frac{1}{(\sqrt{(p - t)^2 + 1}) \cdot (1 + ( t- p)^2)} d t 
  &= \frac{1}{2}\left[ \frac{t-p}{\sqrt{p^2 - pt + t^2 + 1}} \right]_{-1}^{1} \\
  &= \frac{1}{2} \left( \frac{1-p}{\sqrt{p^2 - 1 p + 1^2 + 1}} -  \frac{(-1)-p}{\sqrt{p^2 - p (-1) + (-1)^2 + 1}} \right)\\
  &= \frac{1}{2} \left( \frac{1-p}{\sqrt{p^2 - 1 p + 1^2 + 1}} + \frac{1+p}{\sqrt{p^2 - p (-1) + (-1)^2 + 1}} \right)\\
  &= \frac{1}{2} \left( \frac{1-p}{\sqrt{p^2 - p + 2}} + \frac{1+p}{\sqrt{p^2 + p + 2}} \right)\\
  &= L((p,0), w_o)
\end{align*}
% This seems mostly correct, but i lost a -2p and +2p somewhere, when compared to the solution of a.
% or it is wrong in a)

\section*{4.3 Simple Path Tracer}


\end{document}
