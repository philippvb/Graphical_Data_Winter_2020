\newcommand{\NUMBER}{1}
\newcommand{\EXERCISES}{3}
\newcommand{\DEADLINE}{16.11.20}
\newcommand{\COURSE}{Graphical Data}
\newcommand{\STUDENTA}{Philipp von Bachmann}
\newcommand{\STUDENTB}{David Ott}
\documentclass[a4paper]{scrartcl}
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage{amsmath, enumerate, amssymb, multirow, fancyhdr, color, graphicx, lastpage, listings, tikz, pdflscape, subfigure, float, polynom, hyperref, tabularx, forloop, geometry, listings, fancybox, tikz, forest, tabstackengine, cancel, hyperref}
\input kvmacros
\geometry{a4paper,left=3cm, right=3cm, top=3cm, bottom=3cm}
\pagestyle {fancy}
\fancyhead[C]{\COURSE}
\fancyhead[R]{\today}
\fancyfoot[L]{}
\fancyfoot[C]{}
\fancyfoot[R]{Page \thepage /\pageref*{LastPage}}
\def\header#1#2{
  \begin{center}
    {\Large Assignment #1}\\
    %{(Due by: #2)}
  \end{center}
}

\newcounter{punktelistectr}
\newcounter{punkte}
\newcommand{\punkteliste}[2]{%
  \setcounter{punkte}{#2}%
  \addtocounter{punkte}{-#1}%
  \stepcounter{punkte}%<-- also punkte = m-n+1 = Anzahl Spalten[1]
  \begin{center}%
  \begin{tabularx}{\linewidth}[]{@{}*{\thepunkte}{>{\centering\arraybackslash} X|}@{}>{\centering\arraybackslash}X}
      \forloop{punktelistectr}{#1}{\value{punktelistectr} < #2 } %
      {%
        \thepunktelistectr &
      }
      #2 &  $\Sigma$ \\
      \hline
      \forloop{punktelistectr}{#1}{\value{punktelistectr} < #2 } %
      {%
        &
      } &\\
      \forloop{punktelistectr}{#1}{\value{punktelistectr} < #2 } %
      {%
        &
      } &\\
    \end{tabularx}
  \end{center}
}
\begin{document}

\begin{tabularx}{\linewidth}{m{0.3 \linewidth}X}
  \begin{minipage}{\linewidth}
    \STUDENTA\\
    \STUDENTB
  \end{minipage} & \begin{minipage}{\linewidth}
    \punkteliste{1}{\EXERCISES}
  \end{minipage}\\
\end{tabularx}
\header{Nr. \NUMBER}{\DEADLINE}


\section*{1.1 Primary Ray-Generation for a Perspective Camera Model}
To get to the center of the image plane from the origin, we have to move in
direction of the viewing direction $d$: $f\cdot d$. To move in $y$ direction
in the image plane, the vector is already given as the up-vector $u$. As the
vector in $x$ direction is perpendicular to both $d$ and $u$, we can construct
it by $v=d\times u$. Because $u$ and $d$ are normalized, $v$ is also normalized.
To computed how far we have to move in $x$ direction from the center of our
image plane for a given coordinate $x$, we compute $x_{diff}=x-\frac{resX}{2}$.
Similar for $y$ direction. In combination, we end up with
$$d_r = f \cdot d + (x - \frac{resX}{2}) \cdot (d \times u) + (y - \frac{resY}{2}) \cdot u$$
With this definition, the origin of the image plane (pixel coordinates 0,0) is at the lower left.

\section*{1.2 Ray-Surface Intersection}
    \subsection*{a)}
        As the plane is defined by $(p-n)\cdot a=0$, in order to check if $r(t)$
        is in the plane, we have to find a $t$ such that $(r(t)-n)\cdot a=0$.
        \begin{align*}
            &(r(t)-a)\cdot n=0\\
            &((o+t\cdot d)-a)\cdot n=0\\
            &(o+t\cdot d) \cdot n -a\cdot n=0\\
            &(o+t\cdot d) \cdot n =a\cdot n\\
            &o\cdot n+t\cdot d\cdot n =a\cdot n\\
            &t\cdot d\cdot n =a\cdot n-o\cdot n\\
            &t\cdot d\cdot n =a\cdot n-o\cdot n\\
            &t=\frac{a\cdot n-o\cdot n}{d\cdot n}\\
        \end{align*}
        This fraction exists if $d\cdot n \neq 0$, or in other words the vector
        $d$ of the ray is not parallel to the plane. 
    \subsection*{b)}
        For the ray to be possibly in the bounding box for the x-,y-, or z-Direction it needs to hold:
            
        \begin{align*}{}
          min_i \leq r(t)_i \leq max_i \\
          min_i \leq o_i + t d_i \leq max_i \\
        \end{align*}
        for $d_i > 0$ this is:
        \begin{align*}
          \frac{min_i - o_i}{d_i} \leq t \leq \frac{max_i - o_i}{d_i}          
        \end{align*} 
        for $d_i < 0$ this is:
        \begin{align*}
          \frac{max_i - o_i}{d_i} \leq t \leq \frac{min_i - o_i}{d_i}          
        \end{align*} 

        If $d_i = 0$ we check if $min_i < o_i < max_i$. If this is the case we set 
        ${t_{low}}_i = -\infty$ and ${t_{high}}_i = \infty$. Else there are no intersections with the bounding box
        
        In this way we have defined ranges for $t$ for each of the dimensions. 
        To find the total range of $t$ we have to take the maximum of the lower ends of the 
        ranges and the minimum of the upper ends of the ranges.

        We calculate $t_{low} = \frac{min - o}{d}$ and $t_{high} = \frac{max - o}{d}$
        for each dimension (x,y,z) we swap ${t_{low}}_i$ and ${t_{high}}_i$ if $d_i < 0$ to get $t'_{low}$ and $t'_{high}$.
        
        The ray is in the bounding box for $\max(t'_{low}) \leq t \leq \min(t'_{high})$. If $\max(t'_{low}) > \min(t'_{high})$, then
        there are no intersections of the ray with the bounding box. The first intersection of the ray with the bounding box is for 
        $\max(t'_{low})$


    \subsection*{c)}
        There are several ways to do this, here we show a parametical check:\\
        $r(t)$ can only pass through the triangle, if it passes through the
        plane we get if we extend the triangle. We get the normal of the plane
        by computing $n=(p_2 - p_1)\times (p_3 - p_1)$.\\
        If we set $a=p_3$, we can compute the intersection point $p$ of $r(t)$
        and the plane according to 1.2 a). In order to check if $p$ is on the
        plane, we check there exist $\alpha , \beta$ such that $p=p_1 + \alpha
        \cdot (p_2 - p_1 ) + \beta (p_3 - p_1 )$, with $\alpha , \beta \geq 0,
        \alpha + \beta \leq 1$.

        TODO How do you compute $\alpha, \beta$?

\end{document}
